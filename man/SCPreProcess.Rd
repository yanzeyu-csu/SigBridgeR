% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/10-SCPreProcess.R
\name{SCPreProcess}
\alias{SCPreProcess}
\alias{SCPreProcess.default}
\alias{SCPreProcess.R6}
\alias{SCPreProcess.Seurat}
\title{Single-Cell RNA-seq Preprocessing Pipeline}
\usage{
SCPreProcess(sc, ...)

\method{SCPreProcess}{default}(
  sc,
  meta_data = NULL,
  column2only_tumor = NULL,
  project = "SC_Screening_Proj",
  min_cells = 400L,
  min_features = 0L,
  quality_control = list(pattern = c("^MT-")),
  data_filter = list(nFeature_RNA_thresh = c(200L, 6000L), nCount_RNA_thresh = c(500L,
    50000L), percent.mt = 20L, percent.rp = 60L),
  normalization_method = "LogNormalize",
  scale_factor = 10000L,
  scale_features = NULL,
  selection_method = "vst",
  resolution = 0.6,
  dims = NULL,
  ...
)

\method{SCPreProcess}{R6}(
  sc,
  meta_data = NULL,
  column2only_tumor = NULL,
  project = "SC_Screening_Proj",
  min_cells = 400L,
  min_features = 0L,
  quality_control = list(pattern = c("^MT-")),
  data_filter = list(nFeature_RNA_thresh = c(200L, 6000L), nCount_RNA_thresh = c(500L,
    50000L), percent.mt = 20L, percent.rp = 60L),
  normalization_method = "LogNormalize",
  scale_factor = 10000L,
  scale_features = NULL,
  selection_method = "vst",
  resolution = 0.6,
  dims = NULL,
  ...
)

\method{SCPreProcess}{Seurat}(sc, column2only_tumor = NULL, ...)
}
\arguments{
\item{sc}{Input data, one of:
\itemize{
\item \code{data.frame/matrix/dgCMatrix}: Raw count matrix (features x cells)
\item \code{R6}: Python AnnData object, obtained via package \code{anndata} or \code{anndataR}
\item \code{Seurat}: Preprocessed Seurat object
}}

\item{...}{Additional arguments passed to specific methods. Currently supports:
\itemize{
\item \code{verbose}: Logical indicating whether to print progress messages. Defaults to \code{TRUE}.
\item \code{dims_Neighbors}: Dimensions to use for \code{FindNeighbors}. Defaults to \code{NULL}, using \code{dims}.
\item \code{dims_TSNE}: Dimensions to use for \code{RunTSNE}. Defaults to \code{NULL}, using \code{dims}.
\item \code{dims_UMAP}: Dimensions to use for \code{RunUMAP}. Defaults to \code{NULL}, using \code{dims}.
}}

\item{meta_data}{A data.frame containing metadata for each cell. It will be
added to the Seurat object as \verb{@meta.data}. If sc is an anndata object,
\code{obs} will be automatically used.}

\item{column2only_tumor}{A character of column names in \code{meta_data}, used to
filter the Seurat object to only tumor cells. If \code{NULL}, no filtering is performed.}

\item{project}{A character of project name, used to name the Seurat object.}

\item{min_cells}{Minimum number of cells that must express a feature for it
to be included in the analysis. Defaults to \code{400L}.}

\item{min_features}{Minimum number of features that must be detected in a
cell for it to be included in the analysis. Defaults to \code{0L}.}

\item{quality_control}{A \code{list} of QC settings. If \code{NULL}, no QC metrics are computed.
Default: \code{list(pattern = "^MT-")}.
\describe{
\item{pattern}{A character vector of regex patterns to identify gene groups (e.g., mitochondrial, ribosomal).}
}}

\item{data_filter}{A \code{list} of filtering thresholds. If \code{NULL}, no cell filtering is performed.
Default:
\code{list(
     nFeature_RNA_thresh = c(200L, 6000L),
     nCount_RNA_thresh = c(500L, 50000L),
     percent.mt = 20L,
     percent.rp = 60L
   )}}

\item{normalization_method}{Method for normalization: "LogNormalize", "CLR",
or "RC". Defaults to \code{"LogNormalize"}.}

\item{scale_factor}{Scaling factor for normalization. Defaults to \code{10000L}.}

\item{scale_features}{Features to use for scaling. If NULL, uses all variable
features. If \code{"hvg"}, uses high-variance genes via \code{VariableFeatures()}. Defaults to \code{NULL}.}

\item{selection_method}{Method for variable feature selection: "vst", "mvp",
or "disp". Defaults to \code{"vst"}.}

\item{resolution}{Resolution parameter for clustering. Higher values lead to
more clusters. Defaults to \code{0.6}.}

\item{dims}{Dimensions to use for clustering and dimensionality reduction.
If NULL, automatically determined by elbow method. Defaults to \code{NULL}.}
}
\value{
A Seurat object containing:
\itemize{
\item Normalized and scaled expression data
\item Variable features identified by selection method
\item PCA, t-SNE, and UMAP dimensionality reductions
\item Cluster identities at specified resolution
\item Quality control metrics in \verb{@meta.data}
\item When tumor cells filtered: original dimensions in \verb{@misc$raw_dim}
\item Final dimensions in \verb{@misc$self_dim}
\item Quality control column names in \verb{@misc$qc_colnames}
}
}
\description{
A generic function for standardized preprocessing of single-cell RNA-seq data
from multiple sources. Handles data.frame/matrix, AnnData, and Seurat inputs
with tumor cell filtering. Implements a complete analysis pipeline
from raw data to clustered embeddings.
}
\details{
\strong{Quality Control Patterns:}
The function supports flexible pattern matching for quality control, for example:
\itemize{
\item \code{"^MT-"} - Mitochondrial genes (default)
\item \code{"^RP\[LS\]"} - Ribosomal protein genes
\item \code{"^\[rt\]rna"} - rRNA and tRNA genes
\item Custom patterns using regular expressions
\item Combined patterns: \code{"^MT-|^RP\[LS\]"} for both mitochondrial and ribosomal genes
}

\strong{Flexible Filtering:}
The filtering system dynamically adapts to detected quality control patterns:
\itemize{
\item Column names are automatically generated from patterns
\item Multiple thresholds can be specified in \code{data_filter.thresh}
\item Use \code{SigBridgeR:::Pattern2Colname} to determine correct column names for custom patterns if still confused
}
}
\examples{
\dontrun{
# Example with matrix input
counts_matrix <- matrix(rpois(1000, 5), nrow = 100, ncol = 10)
rownames(counts_matrix) <- paste0("Gene", 1:100)
colnames(counts_matrix) <- paste0("Cell", 1:10)

seurat_obj <- SCPreProcess(
  sc = counts_matrix,
  project = "TestProject",
  min_features = 50,
  resolution = 0.8
)

# Example with tumor cell filtering
metadata <- data.frame(
  cell_type = c(rep("Tumor", 5), rep("Normal", 5)),
  row.names = paste0("Cell", 1:10)
)

tumor_seurat <- SCPreProcess(
  sc = counts_matrix,
  meta_data = metadata,
  column2only_tumor = "cell_type",
  project = "TumorAnalysis"
)
}

}
\seealso{
\code{\link[Seurat]{CreateSeuratObject}},
\code{\link[Seurat]{NormalizeData}},
\code{\link[Seurat]{ScaleData}},
\code{\link[Seurat]{FindVariableFeatures}},
\code{\link[Seurat]{RunPCA}},
\code{\link[Seurat]{RunTSNE}},
\code{\link[Seurat]{RunUMAP}},
\code{\link[Seurat]{FindNeighbors}},
\code{\link[Seurat]{FindClusters}}
}
