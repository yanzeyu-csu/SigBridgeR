% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/24-scPP_Screen.R
\name{ScPP.optimized}
\alias{ScPP.optimized}
\title{scPP Screening with Optimal Threshold Detection}
\usage{
ScPP.optimized(
  sc_dataset,
  geneList,
  probs = c(0.2, NULL),
  verbose = getFuncOption("verbose"),
  parallel = FALSE,
  workers = NULL,
  seed = 123L
)
}
\arguments{
\item{sc_dataset}{A Seurat object containing single-cell RNA-seq data.
Must have RNA assay with normalized data.}

\item{geneList}{A named list containing gene sets:
\itemize{
\item \code{gene_pos} - Genes associated with positive phenotype (required)
\item \code{gene_neg} - Genes associated with negative phenotype (required)
\item \code{genes_sort} - Named numeric vector of ranked genes (required for optimization mode)
}}

\item{probs}{Numeric value or vector of probability thresholds:
\itemize{
\item Single value (e.g., 0.2): Performs phenotype profiling with fixed threshold
\item Multiple values (e.g., seq(0.2, 0.45, by = 0.05)): Finds optimal threshold
\item NULL (default): Automatically searches optimal threshold using seq(0.2, 0.45, by = 0.05)
}}

\item{verbose}{Logical, whether to print progress messages.}
}
\value{
A list with three components:
\itemize{
\item \code{metadata} - Data frame with cell metadata including scPP_AUCup, scPP_AUCdown, scPP
\item \code{Genes_pos} - Genes upregulated in Positive vs Negative
\item \code{Genes_neg} - Genes upregulated in Negative vs Positive
}
}
\description{
Performs single-cell phenotype screening using gene set enrichment analysis.
Can either use a fixed probability threshold or automatically find the optimal
threshold by testing multiple values and maximizing NES difference.
}
\details{
This function operates in two modes based on the \code{probs} parameter:
\subsection{Fixed Threshold Mode (length(probs) == 1):}{
\enumerate{
\item Computes AUCell scores for positive and negative gene sets
\item Classifies cells based on the specified threshold
\item Identifies differential markers between phenotype groups
\item Returns complete results with metadata and marker genes
}
}

\subsection{Optimization Mode (length(probs) > 1 or NULL):}{
\enumerate{
\item Tests multiple probability thresholds
\item For each threshold, classifies cells and finds markers
\item Runs GSEA to calculate NES for marker sets
\item Returns threshold with maximum NES difference (Positive - Negative)
\item Requires \code{genes_sort} in geneList for GSEA analysis
}
}
}
\note{
\itemize{
\item Fixed threshold mode: Faster, returns detailed results
\item Optimization mode: Slower, requires genes_sort, but robust
}
}
\examples{
\dontrun{
# Fixed threshold mode
result <- ScPP.optimized(
  sc_dataset = seurat_obj,
  geneList = list(
    gene_pos = c("CD4", "IL7R"),
    gene_neg = c("CD8A", "CD8B")
  ),
  probs = 0.2
)

# Optimization mode
result <- ScPP.optimized(
  sc_dataset = seurat_obj,
  geneList = list(
    gene_pos = c("CD4", "IL7R"),
    gene_neg = c("CD8A", "CD8B"),
    genes_sort = ranked_genes
  ),
  probs = NULL  # or seq(0.2, 0.45, by = 0.05)
)
}

}
\seealso{
\code{\link[AUCell:AUCell_calcAUC]{AUCell::AUCell_calcAUC()}}, \code{\link[Seurat:FindMarkers]{Seurat::FindMarkers()}}, \code{\link[fgsea:fgsea]{fgsea::fgsea()}}

Other scPP: 
\code{\link{Check0VarRows}()},
\code{\link{DoscPP}()}
}
\concept{scPP}
\keyword{internal}
